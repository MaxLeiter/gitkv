"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("fs"),t=require("path"),r=require("@rollup/pluginutils"),n=require("@swc/core"),i=require("@fastify/deepmerge"),s=require("get-tsconfig"),l=require("rollup-preserve-directives");function a(e){return e&&e.__esModule?e:{default:e}}var o=a(e),u=a(t),c=a(i),d=a(l);const f=new Map,p=(e,t,r)=>{var n,i,l;let a=`${t}:${null!=r?r:"undefined"}`;if(f.has(a))return null!==(n=f.get(a))&&void 0!==n?n:{};if(r&&u.default.isAbsolute(r)){let e=null!==(i=s.parseTsconfig(r).compilerOptions)&&void 0!==i?i:{},t=u.default.dirname(r);return null!=e.paths&&(e.baseUrl=null!=e.baseUrl?u.default.resolve(t,e.baseUrl):t),f.set(a,e),e}let o=s.getTsconfig(t,r||"tsconfig.json");o||r||(e.warn({message:"Can't find tsconfig.json, trying jsconfig.json now",pluginCode:"SWC_TSCONFIG_NOT_EXISTS"}),o=s.getTsconfig(t,"jsconfig.json"));let c=null!==(l=null==o?void 0:o.config.compilerOptions)&&void 0!==l?l:{};if(null!=c.paths&&(null==o?void 0:o.path)){let e=u.default.dirname(o.path);c.baseUrl=null!=c.baseUrl?u.default.resolve(e,c.baseUrl):e}return f.set(a,c),c},m=/\.[cm]?[jt]sx?$/,v=/node_modules/,x=[".ts",".tsx",".mjs",".js",".cjs",".jsx"],g=c.default({all:!0,mergeArray:e=>(t,r)=>e.clone(r)}),j=e=>o.default.promises.access(e,o.default.constants.F_OK).then(()=>!0).catch(()=>!1);function y(e={}){let i=r.createFilter(e.include||m,e.exclude||v),s=e.extensions||x,l=async(e,r=!1)=>{let n=e.replace(m,"");for(let i of s){let s=r?t.join(e,`index${i}`):`${n}${i}`;if(await j(s))return s}return null};return{name:"swc",async resolveId(e,r){if(e.startsWith("\x00")||!i(r))return null;if(r&&"."===e[0]){let n=t.resolve(r?t.dirname(r):process.cwd(),e),i=await l(n);if(i||!i&&await j(n)&&(await o.default.promises.stat(n)).isDirectory()&&(i=await l(n,!0)))return i}},async transform(r,l){var a;if(!i(l))return null;let o=t.extname(l);if(!s.includes(o))return null;let u=".ts"===o||".mts"===o||".cts"===o||".tsx"===o,c=!1===e.tsconfig?{}:p(this,t.dirname(l),e.tsconfig),d="react-jsx"===c.jsx||"react-jsxdev"===c.jsx,f={jsc:{externalHelpers:c.importHelpers,parser:{syntax:u?"typescript":"ecmascript",[u?"tsx":"jsx"]:u?".tsx"===o:".jsx"===o,decorators:c.experimentalDecorators},transform:{decoratorMetadata:c.emitDecoratorMetadata,react:{runtime:d?"automatic":"classic",importSource:c.jsxImportSource,pragma:c.jsxFactory,pragmaFrag:c.jsxFragmentFactory,development:"react-jsxdev"===c.jsx||void 0}},target:null===(a=c.target)||void 0===a?void 0:a.toLowerCase(),baseUrl:c.baseUrl,paths:c.paths}},{filename:m,include:v,exclude:x,tsconfig:j,extensions:y,minify:w,...h}=e,b=g(f,h,{jsc:{minify:void 0},filename:l,minify:!1});return n.transform(r,b)},renderChunk(t){var r,i,s,l,a;return e.minify||(null===(i=e.jsc)||void 0===i?void 0:null===(r=i.minify)||void 0===r?void 0:r.mangle)||(null===(l=e.jsc)||void 0===l?void 0:null===(s=l.minify)||void 0===s?void 0:s.compress)?n.minify(t,{...null===(a=e.jsc)||void 0===a?void 0:a.minify,module:!0}):null}}}Object.defineProperty(exports,"preserveUseDirective",{enumerable:!0,get:function(){return d.default}}),exports.default=y,exports.defineRollupSwcMinifyOption=function(e){return e},exports.defineRollupSwcOption=function(e){return e},exports.minify=function(e={}){return{name:"swc-minify",renderChunk:t=>n.minify(t,e)}},exports.swc=y;
